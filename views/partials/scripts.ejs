<script>   

    var ws = new WebSocket('ws://www.seismicportal.eu/standing_order/websocket')

    ws.onopen = () => {
        // websocket connection opened
        console.log("websocket opened on browser");
        console.log("");
    }

    ws.onmessage = (message) => {
        // message from server
        console.log("earthquake data:");
        console.log(message.data);
        console.log("");
    }

    ws.onclose = (event) => {
        // websocket connection closes for unknown reason thus open a connection again
        console.log("websocket closed");
        console.log(event);
        ws = new WebSocket('ws://www.seismicportal.eu/standing_order/websocket');
        console.log("websocket opened");
        console.log("");
    }


    // when browser is closed or navigates away close the webbsocket
    window.onbeforeunload = function(event) {
        console.log("browser going away (close or redirect)");
        console.log("");
        ws.onclose = function() {};
        ws.close();
    };

    var counter = 1;

    // keep websocket connection open by sending a message to the server every 5 minutes
    window.setInterval(function() {
        ws.send("ping");
        console.log("ping...", counter);
        console.log("");
        counter++;
    }, 300000);


</script>  